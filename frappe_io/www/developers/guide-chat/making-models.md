# Making Models

Now that the application is installed on the bench and the site, we can proceed to create our models, Chat Agent, Chat Session and Chat Message

#### Developer Mode

Models are saved in the repository as `.txt` (JSON) files. To export models automatically as you make them, you must set `developer_mode = 1` in the `site_config.json` file in your site. The file should be:

	{
	 "db_name": "chat",
	 "db_password": [autogenerated],
	 "developer_mode": 1
	}

For that we must create a new `module` in the `app`. Since there will be only one module, let us call it same as the app, `Website Chat`.


#### App Structure

	- App
		- Module 1
			- DocType 1
			- DocType 2
			- DocType 3
			..
		- Module 2
			- DocType 10
			..
		- Module 3
			- DocType 20
			..

### Module Def

A new module is created from the web interface. Go to, click on:

> File > New... > Module Def

![New Module](/assets/frappe_io/images/app-development/new-module.png)


After the new `Module Def` is created, we can create our models - **DocTypes**

If it is not automatically added, add the new module to the `modules.txt` file in the app folder

### DocTypes

Let us create the doctype for **Website Chat Session**

To create a new DocType, go to:

> File > New... > DocType


1. Select `Website Chat` as the module
2. Let us create 4 Fields
	- Status - is the session active or archived
	- Client Info: Name, Email, Question and Question Type (if such an option is set)
	- ![New Doctype](/assets/frappe_io/images/app-development/doctype-add-field.png)
3. Set autoname to `Chat-.#####` so that it gets numbered as Chat-00001, Chat-00002 etc
4. Permissions: We need to give permissions for this. Now, Website Chat Session will created automatically when a new user wants to chat, so lets just keep the permissions for **System Manager**, the default role. We can revisit this later.
5. Save: When you click on save, the system will prompt you for the name of the DocType. Enter "Website Chat Session" and save it.

![New Doctype](/assets/frappe_io/images/app-development/doctype-chat-session.png)

#### Files

When you save DocType, a new folder is created in the `doctype` folder of the `website_chat/website_chat` module, with empty js and csv files.

	- website_chat
		- website_chat
			- doctype
				- website_chat_sesssion
					- __init__.py
					- website_chat_session.py
					- website_chat_session.txt


#### Website Chat Agent

Similarly create DocTypes for **Website Chat Agent**

1. Each agent must be linked to a user, so we use the "Link" field to set that. Also every session must be linked to an agent, so we must also add a link for **Website Chat Agent** to the **Website Chat Session**.
1. Let us name the Agent as the email id of the user it is linked with. So in autoname, we set `field:user`
1. The System Manager must be given rights to create a new Agent.

![Saved DocType](/assets/frappe_io/images/app-development/doctype-agent-saved.png)

#### Link the Agent to the Session

Tables can be linked to each other by

![Child Field](/assets/frappe_io/images/app-development/doctype-agent-link.png)

#### Child Tables

In Frappe, you can define DocTypes are *child* DocTypes. This means that they appear as tables (grids) inside forms. For our model, we can consider the Website Chat Message to be a child table for Website Chat Session.

##### 1. Create a DocType for **Website Chat Message**

1. Check "Is Child Table" property
1. No need to set naming and permissions. Naming does not matter for child records and permissions are same as the parent.

##### 2. Add a **Table** type field in Website Chat Session

Note: As convention, Link Fields and Table Fields are named same as the DocTypes. The table fields are named as plural.

![Child Field](/assets/frappe_io/images/app-development/doctype-table-link.png)

### Desktop Icon

To get the desktop icon, edit the `website_chat/config/desktop.py` file to set:

	from frappe import _

	def get_data():
		return {
			"Website Chat": {
				"color": "#f1c40f",
				"icon": "icon-comments",
				"label": _("Website Chat"),
				"link": "Module/Website Chat"
			}
		}

Do **Tools > Clear Cache & Refresh** and see the icon. When you click on the icon for Website Chat module, you will be able to see the **Website Chat Session** and **Website Chat Agent** links.

![New Page](/assets/frappe_io/images/app-development/module.png)

{next}
